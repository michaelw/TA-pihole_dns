# DO NOT EDIT THIS FILE!
# Please make all changes to files in $SPLUNK_HOME/etc/apps/TA_pihole_dns/local.
# To make changes, copy the section/stanza you want to change from $SPLUNK_HOME/etc/apps/TA_pihole_dns/default
# into ../local and edit there.
#====================================
# Sourcetyper
#====================================
[pihole_sourcetyper]
DEST_KEY = MetaData:Sourcetype
REGEX    = dnsmasq-dhcp\[
FORMAT   = sourcetype::pihole:dhcp

#====================================
# Lookups
#====================================
[pihole_rcodes_lookup]
filename      = pihole_rcodes.csv
default_match = unassigned
max_matches   = 1
min_matches   = 1

[pihole_rtypes_lookup]
filename = pihole_rtypes.csv

#====================================
# Modular RegEx Definitions
#====================================
[pihole_default]
# Matches: Default dnsmasq event
REGEX  = dnsmasq\[[^\]]*\]\:\s\S+\s[^\/]*\/\S+\s

#====================================
# Field Extractions
#====================================
[pihole_pid]
REGEX  = dnsmasq\[([^\]]*)\]
FORMAT = pid::$1

[pihole_transaction_id]
REGEX  = dnsmasq\[[^\]]*\]\:\s(\d+)\s
FORMAT = transaction_id::$1

[pihole_src_src_port]
REGEX  = dnsmasq\[[^\]]*\]\:\s\S+\s([^\/]*)\/(\S+)\s
FORMAT = src_ip::$1 src_port::$2

[pihole_query]
REGEX  = [[pihole_default]]([^\[]*)\[([^\]]*)\]\s+(\S+)
FORMAT = message_type::Query name::$1 record_type::$2 query::$3

[pihole_response]
REGEX  = [[pihole_default]]([^vd][^o]\S+)\s+(\S+)\s+is\s+(.+)
FORMAT = message_type::Response name::$1 query::$2 answer::$3

[pihole_config]
REGEX  = config\s+(\S+)\s+is\s+(\S+)
FORMAT = message_type::Response name::config query::$1 reply_code::$2

[pihole_validation]
REGEX  = validation\s+result\s+is\s+(\S+)
FORMAT = name::validation validation_result::$1

[pihole_forwarded]
REGEX  = forwarded\s+(\S+)\s+to\s+(.+)
FORMAT = name::forwarded query::$1 dest::$2

[pihole_ftl_metrics]
REGEX  = \-\>\s([^\:]*)\:\s(\S+)
FORMAT = metric::$1 metric_value::$2

[pihole_ftl_config]
REGEX  = \]\s{2,}([^\:\-]*)\:\s(.+)
FORMAT = config::$1 config_value::$2

[pihole_ftl_msg]
REGEX  = \]\s([^\s].+)
FORMAT = msg::$1

[pihole_ftl_blacklist]
REGEX  = gravity\.list\: parsed (\d+)
FORMAT = blacklist_count::$1

#====================================
# Field Extractions: Pihole v5
#====================================
[pihole_gravity]
REGEX  = gravity blocked (\S+)
FORMAT = query::$1 vendor_action::blocked message_type::Response name::gravity

[pihole_regex_blacklist]
REGEX  = regex\s+blacklisted\s+(\S+)
FORMAT = query::$1 vendor_action::blocked message_type::Response name::regex_blacklist

[pihole_exact_blacklist]
REGEX  = exactly\s+blacklisted\s+(\S+)
FORMAT = query::$1 vendor_action::blocked message_type::Response name::exact_blacklist

#====================================
# Field Extractions: Pihole DHCP
#====================================
[pihole_dhcp_events]
REGEX  = \]: ([^\(]+)\(([^\)]+)\)
FORMAT = vendor_event::$1 interface::$2

[pihole_dhcp_lease]
REGEX = [[pihole_dhcp_events]] (?<client_ip>\S*) (?<client_mac>\S*) (?<client_name>\S*)

[pihole_dhcp_all]
REGEX = [[pihole_dhcp_events]] (?<client_ip>\S+) (?<client_mac>\S+)$

[pihole_dhcp_lease_info]
REGEX = DHCP, IP range (?<range_start>\S+) -- (?<range_end>\S+), lease time (?<lease_time>\S+)
